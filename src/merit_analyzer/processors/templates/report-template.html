<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merit Test Failure Analysis Report</title>
    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg: hsl(215, 28%, 6%);
            --panel: hsl(217, 29%, 9%);
            --elevated: hsl(218, 30%, 12%);
            --border: hsl(217, 20%, 18%);
            --text: hsl(210, 40%, 96%);
            --text-muted: hsl(210, 12%, 64%);
            --accent: hsl(221, 83%, 72%);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-feature-settings: "rlig" 1, "calt" 1;
            padding: 24px;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
        }
        
        .back-button {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            margin-bottom: 24px;
        }
        
        .back-button:hover {
            color: var(--text);
            background: var(--elevated);
        }
        
        .header-card {
            background: linear-gradient(135deg, var(--panel) 0%, var(--elevated) 100%);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .header-left {
            flex: 1;
        }
        
        .header-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .icon-box {
            padding: 12px;
            background: rgba(124, 158, 255, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(124, 158, 255, 0.3);
        }
        
        .icon-box svg {
            width: 24px;
            height: 24px;
            color: var(--accent);
        }
        
        h1 {
            font-size: 30px;
            font-weight: 700;
            color: var(--text);
            margin: 0;
        }
        
        .header-badges {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }
        
        .badge {
            padding: 6px 12px;
            background: var(--elevated);
            border-radius: 999px;
            font-size: 14px;
            color: var(--text-muted);
            border: 1px solid var(--border);
        }
        
        .report-id {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: monospace;
            font-size: 12px;
            background: var(--elevated);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .copy-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }
        
        .copy-btn:hover {
            color: var(--text);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .summary-card {
            border-radius: 12px;
            padding: 20px;
            border: 1px solid;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .summary-card.critical {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .summary-card.high {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(234, 88, 12, 0.05) 100%);
            border-color: rgba(249, 115, 22, 0.3);
        }
        
        .summary-card.fixes {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .summary-card.tests {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            border-color: rgba(168, 85, 247, 0.3);
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .summary-icon {
            padding: 8px;
            border-radius: 8px;
            border: 1px solid;
        }
        
        .summary-card.critical .summary-icon {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .summary-card.high .summary-icon {
            background: rgba(249, 115, 22, 0.2);
            border-color: rgba(249, 115, 22, 0.3);
        }
        
        .summary-card.fixes .summary-icon {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .summary-card.tests .summary-icon {
            background: rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.3);
        }
        
        .summary-icon svg {
            width: 20px;
            height: 20px;
        }
        
        .summary-card.critical .summary-icon svg {
            color: rgb(248, 113, 113);
        }
        
        .summary-card.high .summary-icon svg {
            color: rgb(251, 146, 60);
        }
        
        .summary-card.fixes .summary-icon svg {
            color: rgb(96, 165, 250);
        }
        
        .summary-card.tests .summary-icon svg {
            color: rgb(196, 181, 253);
        }
        
        .summary-badge {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid;
        }
        
        .summary-card.critical .summary-badge {
            background: rgba(239, 68, 68, 0.2);
            color: rgb(248, 113, 113);
            border-color: rgba(239, 68, 68, 0.4);
        }
        
        .summary-card.high .summary-badge {
            background: rgba(249, 115, 22, 0.2);
            color: rgb(251, 146, 60);
            border-color: rgba(249, 115, 22, 0.4);
        }
        
        .summary-card.fixes .summary-badge {
            background: rgba(59, 130, 246, 0.2);
            color: rgb(96, 165, 250);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .summary-card.tests .summary-badge {
            background: rgba(168, 85, 247, 0.2);
            color: rgb(196, 181, 253);
            border-color: rgba(168, 85, 247, 0.4);
        }
        
        .summary-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }
        
        .summary-label {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .clusters {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .cluster-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .cluster-card:hover {
            border-color: rgba(124, 158, 255, 0.3);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .cluster-card.expanded {
            border-left-width: 4px;
        }
        
        .cluster-card.expanded.critical {
            border-left-color: rgb(239, 68, 68);
        }
        
        .cluster-card.expanded.high {
            border-left-color: rgb(249, 115, 22);
        }
        
        .cluster-card.expanded.medium {
            border-left-color: rgb(234, 179, 8);
        }
        
        .cluster-card.expanded.low {
            border-left-color: rgb(59, 130, 246);
        }
        
        .cluster-header {
            padding: 24px;
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .cluster-header:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .chevron {
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .chevron svg {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
        }
        
        .cluster-info {
            flex: 1;
            min-width: 0;
        }
        
        .cluster-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .cluster-number {
            font-size: 14px;
            font-family: monospace;
            color: var(--text-muted);
        }
        
        .cluster-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }
        
        .severity-badge {
            font-size: 12px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid;
        }
        
        .severity-badge.critical {
            background: rgba(239, 68, 68, 0.1);
            color: rgb(248, 113, 113);
            border-color: rgba(239, 68, 68, 0.2);
        }
        
        .severity-badge.high {
            background: rgba(249, 115, 22, 0.1);
            color: rgb(251, 146, 60);
            border-color: rgba(249, 115, 22, 0.2);
        }
        
        .severity-badge.medium {
            background: rgba(234, 179, 8, 0.1);
            color: rgb(250, 204, 21);
            border-color: rgba(234, 179, 8, 0.2);
        }
        
        .severity-badge.low {
            background: rgba(59, 130, 246, 0.1);
            color: rgb(96, 165, 250);
            border-color: rgba(59, 130, 246, 0.2);
        }
        
        .cluster-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .cluster-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .cluster-meta-item svg {
            width: 14px;
            height: 14px;
        }
        
        .cluster-content {
            padding: 0 24px 24px 24px;
            display: none;
        }
        
        .cluster-content.expanded {
            display: block;
        }
        
        .section {
            margin-bottom: 24px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .section-icon {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid;
        }
        
        .section-icon.alert {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .section-icon.alert svg {
            width: 16px;
            height: 16px;
            color: rgb(248, 113, 113);
        }
        
        .section-icon.code {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .section-icon.code svg {
            width: 16px;
            height: 16px;
            color: rgb(96, 165, 250);
        }
        
        .section-icon.traceback {
            background: rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.3);
        }
        
        .section-icon.traceback svg {
            width: 16px;
            height: 16px;
            color: rgb(196, 181, 253);
        }
        
        .section-icon.fixes {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .section-icon.fixes svg {
            width: 16px;
            height: 16px;
            color: rgb(74, 222, 128);
        }
        
        .section-icon.tests {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .section-icon.tests svg {
            width: 16px;
            height: 16px;
            color: rgb(248, 113, 113);
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .problematic-behavior {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
        }
        
        .problematic-behavior p {
            color: var(--text);
            line-height: 1.6;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
        }
        
        .component-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 16px;
            transition: border-color 0.2s;
        }
        
        .component-card:hover {
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .component-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .component-header svg {
            width: 16px;
            height: 16px;
            color: rgb(96, 165, 250);
        }
        
        .component-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            font-family: monospace;
        }
        
        .component-file {
            font-size: 12px;
            color: var(--text-muted);
            font-family: monospace;
            margin-bottom: 8px;
        }
        
        .component-type {
            font-size: 12px;
            padding: 4px 8px;
            background: rgba(59, 130, 246, 0.2);
            color: rgb(96, 165, 250);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 4px;
            display: inline-block;
        }
        
        .traceback-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .traceback-frame {
            background: linear-gradient(to right, rgba(168, 85, 247, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            border-left: 4px solid rgba(168, 85, 247, 0.5);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-left-width: 4px;
            border-radius: 8px;
            padding: 16px;
            transition: border-color 0.2s;
        }
        
        .traceback-frame:hover {
            border-color: rgba(168, 85, 247, 0.5);
        }
        
        .traceback-frame-label {
            font-size: 12px;
            font-weight: 700;
            color: rgb(196, 181, 253);
            background: rgba(168, 85, 247, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(168, 85, 247, 0.4);
            display: inline-block;
            margin-bottom: 8px;
        }
        
        .traceback-description {
            font-size: 14px;
            color: var(--text);
            line-height: 1.6;
        }
        
        .fixes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .fix-card {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .fix-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .fix-card.expanded {
            border-color: rgba(124, 158, 255, 0.5);
            background: linear-gradient(135deg, rgba(124, 158, 255, 0.1) 0%, rgba(124, 158, 255, 0.05) 100%);
        }
        
        .fix-header {
            padding: 16px;
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .fix-header:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .fix-icon-box {
            border-radius: 8px;
            padding: 12px;
            border: 1px solid;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .fix-icon-box.prompt {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .fix-icon-box.prompt svg {
            width: 16px;
            height: 16px;
            color: rgb(96, 165, 250);
        }
        
        .fix-icon-box.code {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .fix-icon-box.code svg {
            width: 16px;
            height: 16px;
            color: rgb(74, 222, 128);
        }
        
        .fix-icon-box.config {
            background: rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.3);
        }
        
        .fix-icon-box.config svg {
            width: 16px;
            height: 16px;
            color: rgb(196, 181, 253);
        }
        
        .fix-icon-box.design {
            background: rgba(234, 179, 8, 0.2);
            border-color: rgba(234, 179, 8, 0.3);
        }
        
        .fix-icon-box.design svg {
            width: 16px;
            height: 16px;
            color: rgb(250, 204, 21);
        }
        
        .fix-info {
            flex: 1;
        }
        
        .fix-title-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .fix-type-badge {
            font-size: 12px;
            font-weight: 700;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .fix-type-badge.prompt {
            background: rgba(59, 130, 246, 0.2);
            color: rgb(96, 165, 250);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .fix-type-badge.code {
            background: rgba(34, 197, 94, 0.2);
            color: rgb(74, 222, 128);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .fix-type-badge.config {
            background: rgba(168, 85, 247, 0.2);
            color: rgb(196, 181, 253);
            border-color: rgba(168, 85, 247, 0.3);
        }
        
        .fix-type-badge.design {
            background: rgba(234, 179, 8, 0.2);
            color: rgb(250, 204, 21);
            border-color: rgba(234, 179, 8, 0.3);
        }
        
        .fix-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }
        
        .fix-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
        }
        
        .fix-meta svg {
            width: 12px;
            height: 12px;
        }
        
        .fix-meta-file {
            font-family: monospace;
        }
        
        .fix-lines {
            padding: 4px 8px;
            background: var(--elevated);
            border-radius: 4px;
            border: 1px solid var(--border);
        }
        
        .fix-chevron {
            padding: 8px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--elevated);
        }
        
        .fix-chevron.expanded {
            background: rgba(124, 158, 255, 0.2);
            border-color: rgba(124, 158, 255, 0.3);
        }
        
        .fix-chevron svg {
            width: 16px;
            height: 16px;
            color: var(--text-muted);
        }
        
        .fix-description {
            padding: 16px;
            border-top: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.02);
            display: none;
        }
        
        .fix-description.expanded {
            display: block;
        }
        
        .fix-description p {
            font-size: 14px;
            color: var(--text);
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .tests-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .test-card {
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            transition: border-color 0.2s;
        }
        
        .test-card:hover {
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .test-header {
            padding: 16px;
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .test-header:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .test-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .test-icon {
            padding: 8px;
            background: rgba(239, 68, 68, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .test-icon svg {
            width: 16px;
            height: 16px;
            color: rgb(248, 113, 113);
        }
        
        .test-title-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        
        .test-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        
        .test-failed-badge {
            font-size: 12px;
            padding: 4px 8px;
            background: rgba(239, 68, 68, 0.2);
            color: rgb(248, 113, 113);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 4px;
        }
        
        .test-error-count {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .test-error-count svg {
            width: 12px;
            height: 12px;
        }
        
        .test-chevron {
            padding: 8px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--elevated);
        }
        
        .test-chevron.expanded {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .test-chevron svg {
            width: 16px;
            height: 16px;
            color: var(--text-muted);
        }
        
        .test-content {
            padding: 16px;
            border-top: 1px solid rgba(239, 68, 68, 0.3);
            background: rgba(255, 255, 255, 0.02);
            display: none;
            flex-direction: column;
            gap: 16px;
        }
        
        .test-content.expanded {
            display: flex;
        }
        
        .test-section {
            border-radius: 8px;
            padding: 16px;
        }
        
        .test-section.input {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .test-section.output {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.3);
        }
        
        .test-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .test-section-icon {
            padding: 4px;
            border-radius: 4px;
            border: 1px solid;
        }
        
        .test-section.input .test-section-icon {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .test-section.input .test-section-icon svg {
            width: 12px;
            height: 12px;
            color: rgb(96, 165, 250);
        }
        
        .test-section.output .test-section-icon {
            background: rgba(234, 179, 8, 0.2);
            border-color: rgba(234, 179, 8, 0.3);
        }
        
        .test-section.output .test-section-icon svg {
            width: 12px;
            height: 12px;
            color: rgb(250, 204, 21);
        }
        
        .test-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .test-section pre {
            font-size: 12px;
            background: rgba(255, 255, 255, 0.02);
            padding: 12px;
            border-radius: 4px;
            border: 1px solid var(--border);
            overflow-x: auto;
            color: var(--text);
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .test-errors {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .test-error-item {
            background: linear-gradient(to right, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%);
            border-left: 4px solid rgb(239, 68, 68);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-left-width: 4px;
            border-radius: 8px;
            padding: 12px;
        }
        
        .test-error-item p {
            font-size: 14px;
            color: rgb(252, 165, 165);
            line-height: 1.6;
        }
        
        .test-errors-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .test-errors-icon {
            padding: 4px;
            background: rgba(239, 68, 68, 0.2);
            border-radius: 4px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .test-errors-icon svg {
            width: 12px;
            height: 12px;
            color: rgb(248, 113, 113);
        }
        
        .test-errors-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        button {
            font-family: inherit;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    
    </style>
</head>
<body>
    <div class="container">
        <div class="header-card">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-title-row">
                        <div class="icon-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></svg>
                        </div>
                        <h1>Merit Test Failure Analysis Report</h1>
                    </div>
                    <div class="header-badges">
                        <span class="badge">üìÑ <span id="sourceFile">testing/test_data.csv</span></span>
                        <span class="badge">üîç <span id="errorGroupsCount">‚Äî</span> Error Groups</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="summary-grid">
            <div class="summary-card critical">
                <div class="summary-header">
                    <div class="summary-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2l8 14a2 2 0 0 0 2 2h9.73a2 2 0 0 0 2-2z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                    </div>
                    <span class="summary-badge">Critical</span>
                </div>
                <div class="summary-value" id="criticalCount">‚Äî</div>
                <div class="summary-label">Critical Issues</div>
            </div>
            
            <div class="summary-card high">
                <div class="summary-header">
                    <div class="summary-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
                    </div>
                    <span class="summary-badge">High</span>
                </div>
                <div class="summary-value" id="highCount">‚Äî</div>
                <div class="summary-label">High Priority</div>
            </div>
            
            <div class="summary-card fixes">
                <div class="summary-header">
                    <div class="summary-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
                    </div>
                    <span class="summary-badge">Fixes</span>
                </div>
                <div class="summary-value" id="fixesCount">‚Äî</div>
                <div class="summary-label">Recommended Fixes</div>
            </div>
            
            <div class="summary-card tests">
                <div class="summary-header">
                    <div class="summary-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5s-2.5-1.1-2.5-2.5V2"/><path d="M8.5 2h7"/><path d="M14.5 16h-5"/></svg>
                    </div>
                    <span class="summary-badge">Tests</span>
                </div>
                <div class="summary-value" id="testsCount">‚Äî</div>
                <div class="summary-label">Failed Tests</div>
            </div>
        </div>
        
        <div class="clusters" id="clustersContainer">
            <!-- Clusters will be rendered here by JavaScript -->
        </div>
    </div>
    
    <script type="application/json" id="report-data">
{
  "reportId": "123e4567-e89b-12d3-a456-426614174000",
  "generatedFrom": "testing/test_data.csv",
  "totalErrorGroups": 6,
  "clusters": [
    {
      "id": "1",
      "name": "Unclustered",
      "problematicBehavior": "These failed test cases have not been grouped due to their uniqueness",
      "involvedComponents": [
        {
          "name": "search_company_tool",
          "file": "./company_researcher.py",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "newsletter_writer",
          "file": "./company_researcher.py",
          "type": "ComponentType.CLASS"
        },
        {
          "name": "write_newsletter_task",
          "file": "./company_researcher.py",
          "type": "ComponentType.FUNCTION"
        }
      ],
      "traceback": [
        {
          "frame": "Frame #1",
          "description": "Exa search returns minimal or no results for obscure/non-existent companies, providing insufficient data"
        },
        {
          "frame": "Frame #2",
          "description": "Content truncated at 1000 characters per result loses critical details like founders and metrics"
        },
        {
          "frame": "Frame #3",
          "description": "Writer agent receives empty/minimal research data but has no instruction to refuse or admit insufficient information"
        },
        {
          "frame": "Frame #4",
          "description": "Writer agent hallucinates specific details to fulfill task requirements despite lack of real data"
        },
        {
          "frame": "Frame #5",
          "description": "No validation layer detects fabricated content before returning newsletter to user"
        }
      ],
      "recommendedFixes": [
        {
          "type": "prompt",
          "title": "Add data sufficiency check to Writer agent prompt",
          "description": "Update the newsletter_writer agent backstory and write_newsletter_task description to explicitly instruct: \"If the research data is insufficient, incomplete, or missing, you MUST state this clearly in the newsletter rather than fabricating information. It is better to admit limited information than to create false details.\" This prevents hallucination by giving the agent permission to acknowledge data gaps.",
          "file": "./company_researcher.py",
          "lines": "88-124"
        },
        {
          "type": "code",
          "title": "Add search result validation before writing",
          "description": "Insert validation logic between research_task and write_newsletter_task that checks if Exa returned meaningful results (e.g., total content length > 500 chars, at least 2 results with non-empty text). If validation fails, either skip the write task or pass a flag to the writer indicating \"limited_data_mode\". This creates a quality gate preventing fabrication.",
          "file": "./company_researcher.py",
          "lines": "130-145"
        },
        {
          "type": "config",
          "title": "Increase content truncation limit and add search refinement",
          "description": "Change line 38 from `eachResult.text[:1000]` to `eachResult.text[:2500]` to capture more complete information. Also enhance the search query on line 28-29 by adding company context: f\"\"{question}\" company information products news\" with use_autoprompt=True. This provides more complete data and better search targeting, reducing both truncation issues and ambiguous results.",
          "file": "./company_researcher.py",
          "lines": "38"
        }
      ],
      "relatedFailedTests": [
        {
          "case_data": {
            "case_input": "{\"company_name\": \"SuperPixel AI\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": false, \"includes_company_background\": true, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"3 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! SuperPixel AI is developing cutting-edge image generation technology...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "generic and vague",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Very little concrete information",
              "Mostly generic statements",
              "No specific product details",
              "Fabricated details about AI capabilities"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa search returned minimal results for this obscure startup. Writer agent filled gaps with generic statements that don't provide real value"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Roam Research\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": false, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"3-4 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Roam Research provides a note-taking application for building personal knowledge graphs...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": false,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "generic and unexciting",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Newsletter reads like a product description",
              "Lacks engagement or personality",
              "No insights or interesting angles",
              "Too formal"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent produced a generic product description instead of an engaging newsletter. Tone is formal and lacks the engaging style requested"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Apex Strategy Group\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Apex Strategy Group is a boutique consulting firm providing strategic advisory services to mid-market companies...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "overly formal",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Contains only generic consulting industry boilerplate",
              "No distinguishing features or insights",
              "Very thin content"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa search found no specific information about this private consultancy. Newsletter is comprised entirely of generic consulting industry phrases"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"FakeCompanyXYZ123\"}",
            "reference_value": "{\"newsletter_quality\": \"poor\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"1-2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! FakeCompanyXYZ123 is an emerging technology company focused on innovative solutions...",
            "newsletter_quality": "terrible",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "completely fabricated",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Company doesn't exist - all content is fabricated",
              "No real information whatsoever",
              "Dangerous hallucination - creates false information",
              "Should have said \"no information found\""
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "System created a fictional newsletter for a non-existent company. This is a critical failure - should detect when company doesn't exist and refuse to fabricate content"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Oracle\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Oracle Corporation, the enterprise software giant...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional but mentions multiple companies",
            "length": "4 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Search may have picked up Oracle database AND Oracle corporation articles",
              "Unclear which entity the newsletter is about",
              "Mixed information from different sources"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Ambiguous company name \"Oracle\" caused Exa search to return results about Oracle database, Oracle Corporation, and other Oracle-related entities. Newsletter mixes information from different sources"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Quantum Edge Systems\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": true, \"includes_recent_news\": false, \"includes_company_background\": true, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"3 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Quantum Edge Systems develops quantum computing software solutions...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "generic and vague",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Very limited information available",
              "Generic statements about quantum computing",
              "No specific product details",
              "Could be fabricated"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa search returned minimal results for this obscure startup. Newsletter contains generic quantum computing statements without specific company information"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Phantom Byte Labs\"}",
            "reference_value": "{\"newsletter_quality\": \"poor\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"1-2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Phantom Byte Labs recently launched their flagship product on October 15, 2024...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "professional but fabricated",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Specific launch date is completely fabricated",
              "Product details are fictional",
              "Creates false timeline"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent fabricated specific dates and product launch information when no data was available"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"The United States Advanced Technology Products Manufacturing Corporation\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Unfortunately, limited information is available about this company...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "apologetic",
            "length": "1 paragraph",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Company name too long may confuse search",
              "No results found",
              "Newsletter becomes apology"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Extremely long company name may cause search confusion. Exa returned no results for this generic-sounding corporation"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Unity\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"3-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Unity Technologies provides game development engines for creators worldwide...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Search may have picked up Unity game engine AND other Unity-related content",
              "Could confuse with Unity framework or other companies"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Ambiguous name \"Unity\" may cause search to return mixed results from game engine, frameworks, and other companies with similar names"
            ]
          }
        }
      ]
    },
    {
      "id": "2",
      "name": "CONTENT_TRUNCATION_AT_1000_CHAR_LIMIT_LOSES_CRITICAL_DATA",
      "problematicBehavior": "When content exceeds 1000 characters, the system truncates text at exactly 1000 characters, causing mid-sentence cuts that result in loss of critical information including founder names, financial metrics, product details, and competitive analysis. This hard character limit prevents complete data extraction and analysis.",
      "involvedComponents": [
        {
          "name": "search_company_tool",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "search_news_tool",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "researcher",
          "file": "company_researcher.py",
          "type": "ComponentType.CLASS"
        }
      ],
      "traceback": [
        {
          "frame": "Frame #1",
          "description": "User requests company research via research_company() function with company name as input"
        },
        {
          "frame": "Frame #2",
          "description": "CrewAI Crew kicks off with Researcher Agent calling search_company_tool via Exa API"
        },
        {
          "frame": "Frame #3",
          "description": "search_company_tool at line 28 calls exa.search_and_contents() retrieving 5 results with full text"
        },
        {
          "frame": "Frame #4",
          "description": "Line 38 truncates each result text to 1000 chars via eachResult.text[:1000], cutting mid-sentence"
        },
        {
          "frame": "Frame #5",
          "description": "Truncated content wrapped in XML tags and returned to Researcher Agent\"s context"
        },
        {
          "frame": "Frame #6",
          "description": "Newsletter Writer Agent receives incomplete data from Researcher Agent\"s output"
        },
        {
          "frame": "Frame #7",
          "description": "Writer generates newsletter with missing critical information, failing quality assertions"
        }
      ],
      "recommendedFixes": [
        {
          "type": "code",
          "title": "Remove hard character limits on content extraction",
          "description": "The 1000 and 500 character limits in lines 38 and 62 should be removed or significantly increased (to 5000-10000 characters) to allow complete data extraction. The Exa API already provides full text content - arbitrarily truncating it loses critical information.",
          "file": "company_researcher.py",
          "lines": "38, 62"
        },
        {
          "type": "prompt",
          "title": "Enhance agent prompts to request complete information",
          "description": "Update the Researcher Agent\"s backstory and research_task description to explicitly emphasize gathering COMPLETE information including all founder names, full financial metrics, comprehensive product details, and complete competitive analysis.",
          "file": "company_researcher.py",
          "lines": "79-83, 104-113"
        },
        {
          "type": "design",
          "title": "Implement intelligent content summarization instead of truncation",
          "description": "Replace the naive character-based truncation with a smarter approach: (1) Use the LLM to summarize long content while preserving key facts like names, numbers, and product details, OR (2) Implement sentence-boundary-aware truncation that never cuts mid-sentence.",
          "file": "company_researcher.py",
          "lines": "28-42, 51-66"
        }
      ],
      "relatedFailedTests": [
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Stripe\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Stripe, the fintech giant, was founded by Patrick Collison and...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": true,
            "tone": "professional and engaging",
            "length": "4 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Second founder name (John Collison) was cut off due to 1000 char truncation in search results"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Content truncation at 1000 characters caused incomplete founder information. The text was cut mid-sentence, losing \"John Collison\" mention"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Cohere\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Cohere specializes in enterprise AI and large language models, offering...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Product features cut off at 1000 char limit",
              "Missing details about API capabilities",
              "Competitive positioning incomplete"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Content truncation at 1000 characters in search results caused loss of important product detail. Market position analysis incomplete due to missing context"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Snowflake\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Snowflake is a cloud data platform with revenue of...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Financial metrics cut off mid-sentence due to 1000 char truncation",
              "Missing important valuation information",
              "Revenue details incomplete"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Content truncation at 1000 characters cut off important financial metrics. This prevents readers from getting complete company analysis"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Salesforce\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Salesforce dominates the CRM market but faces increasing competition from Microsoft Dynamics and...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Competitive analysis cut off mid-sentence",
              "Missing competitors like HubSpot and Oracle",
              "Market position incomplete due to truncation"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Content truncation at 1000 characters cut off competitive analysis mid-sentence, preventing complete market positioning"
            ]
          }
        }
      ]
    },
    {
      "id": "3",
      "name": "WRITER_FAILS_TO_SIMPLIFY_TECHNICAL_JARGON_FOR_GENERAL_AUDIENCE",
      "problematicBehavior": "When writer agent receives technical content (AI safety, fintech, blockchain, technical products), it fails to translate specialized terminology into accessible language for general readers, instead preserving technical jargon without explanations and making content only suitable for domain experts rather than the intended general audience.",
      "involvedComponents": [
        {
          "name": "newsletter_writer",
          "file": "/Users/mreith/Marks_Code/Merit/merit-demo/company_researcher.py",
          "type": "ComponentType.CLASS"
        },
        {
          "name": "write_newsletter_task",
          "file": "/Users/mreith/Marks_Code/Merit/merit-demo/company_researcher.py",
          "type": "ComponentType.FUNCTION"
        }
      ],
      "traceback": [
        {
          "frame": "Frame #0",
          "description": "User requests newsletter for technical company (e.g., Databricks, Anthropic, Plaid)"
        },
        {
          "frame": "Frame #1",
          "description": "Researcher agent gathers technical information from Exa search results"
        },
        {
          "frame": "Frame #2",
          "description": "Newsletter writer agent receives technical research data with jargon"
        },
        {
          "frame": "Frame #3",
          "description": "Writer agent\"s backstory lacks explicit jargon-simplification instructions"
        },
        {
          "frame": "Frame #4",
          "description": "Write task description says \"accessible\" but provides no guidance on handling technical terms"
        },
        {
          "frame": "Frame #5",
          "description": "LLM generates newsletter preserving technical jargon from research without explanations"
        },
        {
          "frame": "Frame #6",
          "description": "Output marked as \"too technical\", failing tests for general audience accessibility"
        }
      ],
      "recommendedFixes": [
        {
          "type": "prompt",
          "title": "Add explicit jargon-simplification instructions to writer agent backstory",
          "description": "The newsletter_writer agent\"s backstory needs explicit instructions to translate technical terminology into plain language. Add guidance that the agent should: (1) avoid unexplained jargon, (2) explain technical terms in simple language, (3) assume readers are business professionals without domain expertise, and (4) use analogies and plain language explanations for complex concepts.",
          "file": "/Users/mreith/Marks_Code/Merit/merit-demo/company_researcher.py",
          "lines": "93-97"
        },
        {
          "type": "prompt",
          "title": "Enhance task description with audience definition and jargon-handling examples",
          "description": "The write_newsletter_task description should explicitly define the target audience as \"general business readers who may not have technical expertise\" and provide specific guidance: \"Translate all technical jargon into plain language. For example, instead of \"API infrastructure\", explain \"technology that allows different software systems to communicate\". Define acronyms on first use. Use analogies to explain complex technical concepts.\"",
          "file": "/Users/mreith/Marks_Code/Merit/merit-demo/company_researcher.py",
          "lines": "116-121"
        }
      ],
      "relatedFailedTests": [
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Databricks\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Databricks provides a unified analytics platform built on Apache Spark that enables data engineering, collaborative data science, and machine learning at scale...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "technical and dry",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Newsletter is too technical and dry",
              "Not engaging for general audience",
              "Lacks accessible explanations"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent failed to make technical content accessible and engaging. Used jargon without explanation, making it suitable only for technical readers"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Anthropic\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Anthropic, the AI safety company behind Claude, has been making significant advances...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "too technical",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Too many technical terms without explanation",
              "Assumes reader knows AI terminology",
              "Market competition with OpenAI not addressed"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent failed to translate technical AI safety concepts into accessible language. Overused technical jargon without explanations"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Plaid\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Plaid provides API infrastructure for financial data connectivity enabling OAuth authentication protocols...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "too technical",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Overuse of technical jargon without explanation",
              "Assumes reader understands API terminology",
              "Should explain what Plaid does in plain language"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent failed to translate fintech technical concepts into accessible language for general readers"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Chainlink\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Chainlink operates decentralized oracle networks that facilitate on-chain and off-chain data connectivity through smart contract infrastructure...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "too technical",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Overwhelmed with blockchain terminology",
              "Doesn't explain what oracles are in simple terms",
              "Assumes deep crypto knowledge"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent failed to translate blockchain concepts into accessible language, overwhelming readers with technical jargon"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Hashicorp\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"3-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Hashicorp builds infrastructure automation tools including Terraform for IaC provisioning, Vault for secrets management, and Consul for service mesh...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "too technical",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Overwhelms with product names and acronyms",
              "Doesn't explain what IaC or service mesh means",
              "Assumes DevOps expertise"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent listed technical products without explanation, making content inaccessible to general business readers"
            ]
          }
        }
      ]
    },
    {
      "id": "4",
      "name": "WRITER_AGENT_IGNORES_GREETING_AND_SIGNOFF_INSTRUCTIONS",
      "problematicBehavior": "When the writer agent receives explicit task instructions to include greeting and sign-off formatting elements, it consistently fails to follow these requirements and omits them from the output. In some cases, the agent may also duplicate greetings, indicating potential prompt injection issues or formatting confusion in instruction parsing.",
      "involvedComponents": [
        {
          "name": "write_newsletter_task",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "newsletter_writer",
          "file": "company_researcher.py",
          "type": "ComponentType.CLASS"
        },
        {
          "name": "research_company",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        }
      ],
      "traceback": [
        {
          "frame": "Frame #0",
          "description": "User initiates company research, triggering crew execution with newsletter writing task"
        },
        {
          "frame": "Frame #1",
          "description": "newsletter_writer agent receives task with ambiguous formatting instruction using \"like\" instead of mandatory language"
        },
        {
          "frame": "Frame #2",
          "description": "LLM interprets \"like\" as suggestion rather than requirement, especially for well-known companies"
        },
        {
          "frame": "Frame #3",
          "description": "Agent generates newsletter, sometimes omitting greeting or sign-off based on interpretation of content flow"
        },
        {
          "frame": "Frame #4",
          "description": "In some cases, agent misparses instruction and duplicates the greeting in output"
        },
        {
          "frame": "Frame #5",
          "description": "Generated text is returned without validation, allowing formatting errors to pass through"
        },
        {
          "frame": "Frame #6",
          "description": "Test assertions fail when checking has_greeting and has_signoff flags"
        }
      ],
      "recommendedFixes": [
        {
          "type": "prompt",
          "title": "Strengthen Task Description with Mandatory Language",
          "description": "Replace ambiguous \"like\" language with explicit, mandatory formatting requirements. Separate format requirements from content requirements visually. Add anti-duplication instruction. Use imperative language (MUST) instead of suggestive (like). This ensures the LLM interprets formatting as non-negotiable requirements rather than optional suggestions.",
          "file": "company_researcher.py",
          "lines": "116-121"
        },
        {
          "type": "prompt",
          "title": "Update Agent Backstory to Emphasize Format Compliance",
          "description": "Enhance the newsletter_writer agent\"s backstory to emphasize format compliance and structural requirements. Prime the agent to prioritize formatting instructions alongside content quality. This creates consistency expectation and reinforces that format compliance is part of the agent\"s core responsibility.",
          "file": "company_researcher.py",
          "lines": "93-97"
        },
        {
          "type": "code",
          "title": "Add Output Validation for Required Format Elements",
          "description": "Implement validation logic in the research_company function to check for presence of greeting and sign-off in generated newsletter. Detect and fix duplications. Provide warnings when LLM fails to follow instructions. This safety net ensures reliable output even when prompts occasionally fail to guide the LLM correctly.",
          "file": "company_researcher.py",
          "lines": "127-147"
        }
      ],
      "relatedFailedTests": [
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Tesla\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Tesla, the electric vehicle manufacturer, has been making headlines with its latest innovations...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": true,
            "tone": "professional and engaging",
            "length": "4 paragraphs",
            "has_greeting": false,
            "has_signoff": false,
            "issues": [
              "Missing greeting at start",
              "Missing sign-off at end"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent did not follow instructions to include greeting and sign-off. Task description specifies these requirements but agent output ignored them"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"OpenAI\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "OpenAI continues to push boundaries in artificial intelligence with its latest models...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": true,
            "tone": "professional but not engaging",
            "length": "4 paragraphs",
            "has_greeting": false,
            "has_signoff": false,
            "issues": [
              "Missing greeting despite clear instructions",
              "Missing sign-off",
              "Tone could be more engaging for such an interesting company"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent ignored explicit instructions to include greeting and sign-off, and didn't capture the excitement around OpenAI's developments"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Shopify\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Shopify empowers millions of merchants worldwide with its e-commerce platform...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": true,
            "tone": "professional and engaging",
            "length": "4 paragraphs",
            "has_greeting": false,
            "has_signoff": false,
            "issues": [
              "Missing greeting at start",
              "Missing sign-off at end",
              "Directly jumps into content"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent ignored explicit formatting instructions to include greeting and sign-off despite clear task description"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Slack\"}",
            "reference_value": "{\"newsletter_quality\": \"excellent\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"4-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Welcome to this week's company spotlight! Slack has transformed team communication...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": true,
            "includes_company_background": true,
            "includes_market_position": true,
            "tone": "professional and engaging",
            "length": "5 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Greeting is duplicated",
              "Redundant opening sentence"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent duplicated the greeting, suggesting potential prompt injection or formatting confusion"
            ]
          }
        }
      ]
    },
    {
      "id": "5",
      "name": "NEWSLETTER_LACKS_CONTENT_WHEN_EXA_SEARCH_RETURNS_NO_RESULTS",
      "problematicBehavior": "When Exa search returns no results or minimal results for private, regional, or newer companies, the newsletter generation fails to produce substantive content and instead outputs generic industry statements, apology letters, or extremely short content that lacks company-specific insights and analysis.",
      "involvedComponents": [
        {
          "name": "search_company_tool",
          "file": "<UNKNOWN>",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "search_news_tool",
          "file": "<UNKNOWN>",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "researcher",
          "file": "<UNKNOWN>",
          "type": "ComponentType.CLASS"
        },
        {
          "name": "research_task",
          "file": "<UNKNOWN>",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "newsletter_writer",
          "file": "<UNKNOWN>",
          "type": "ComponentType.CLASS"
        },
        {
          "name": "write_newsletter_task",
          "file": "<UNKNOWN>",
          "type": "ComponentType.FUNCTION"
        }
      ],
      "traceback": [
        {
          "frame": "Frame #1",
          "description": "Exa search returns no or minimal results for private, regional, or newer companies without validation"
        },
        {
          "frame": "Frame #2",
          "description": "Search tools fail to detect or communicate search failures to downstream agents"
        },
        {
          "frame": "Frame #3",
          "description": "Researcher agent receives empty data but has no instructions for handling missing information"
        },
        {
          "frame": "Frame #4",
          "description": "Research task assumes all searches succeed and produces incomplete research output"
        },
        {
          "frame": "Frame #5",
          "description": "Newsletter writer agent receives insufficient data with no guidance on graceful degradation"
        },
        {
          "frame": "Frame #6",
          "description": "Newsletter output becomes apology letters, generic statements, or extremely short content lacking company-specific value"
        }
      ],
      "recommendedFixes": [
        {
          "type": "code",
          "title": "Add result validation to search tools",
          "description": "Implement validation logic in search_company_tool (lines 22-42) and search_news_tool (lines 45-66) to detect when searches return no or minimal results. Add explicit status indicators and quality metrics to tool outputs so downstream agents can identify search failures.",
          "file": "<UNKNOWN>",
          "lines": "22-66"
        },
        {
          "type": "prompt",
          "title": "Update researcher agent prompt with missing data handling",
          "description": "Enhance the researcher agent prompt (lines 74-86) to explicitly instruct the agent on how to handle insufficient search results. Add guidance to document what data is missing, what was found, and suggest alternative research approaches.",
          "file": "<UNKNOWN>",
          "lines": "74-86"
        },
        {
          "type": "prompt",
          "title": "Enhance writer task with graceful degradation strategy",
          "description": "Update the write_newsletter_task instructions (lines 115-124) to provide explicit strategies for handling incomplete research data. Include guidance on how to write engaging content when company-specific information is limited, such as focusing on industry trends, market positioning, or company mission.",
          "file": "<UNKNOWN>",
          "lines": "115-124"
        }
      ],
      "relatedFailedTests": [
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Hebbia\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": true, \"includes_company_background\": true, \"includes_market_position\": true, \"tone\": \"professional and engaging\", \"length\": \"3-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Hebbia is an AI-powered research platform that helps enterprises search through vast amounts of documents...",
            "newsletter_quality": "good",
            "includes_products": true,
            "includes_recent_news": false,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional but generic",
            "length": "3 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Missing recent news",
              "No market position analysis",
              "Could be more specific about product features"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Newsletter missing key elements: no recent news found by Exa search (likely limited results for newer company), market position not analyzed"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Quiet Private Company\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": false, \"includes_company_background\": true, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"3 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! While Quiet Private Company maintains a low profile...",
            "newsletter_quality": "fair",
            "includes_products": true,
            "includes_recent_news": false,
            "includes_company_background": true,
            "includes_market_position": false,
            "tone": "professional but thin",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Very short newsletter due to limited data",
              "News search returned no results",
              "Lacks depth and detail"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa news search returned no results for this private company. Newsletter is thin and lacks substance due to minimal research data"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Proprietary Manufacturing Inc\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Unfortunately, limited information is available about Proprietary Manufacturing Inc...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "apologetic",
            "length": "1 paragraph",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Newsletter is mostly an apology for lack of data",
              "Very short - only one paragraph",
              "Doesn't provide value to reader"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa search found no results for this private company. Newsletter became an apology letter rather than providing any insights"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Smith Family Holdings\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Smith Family Holdings operates in the real estate sector with...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "very generic",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": false,
            "issues": [
              "Almost entirely generic statements",
              "Very little specific information",
              "Missing sign-off",
              "Could apply to any real estate company"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa returned minimal results for this private entity. Newsletter consists of generic industry statements that could apply to any similar company"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Midwest Data Solutions\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Midwest Data Solutions provides enterprise data management solutions to regional businesses...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "dry and technical",
            "length": "1 paragraph",
            "has_greeting": true,
            "has_signoff": false,
            "issues": [
              "Extremely short - barely one paragraph",
              "All generic statements",
              "Missing sign-off",
              "No specific details whatsoever"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa search returned no results for this regional private company. Newsletter is extremely short with only generic industry statements"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Enterprise Data Hub Solutions\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Enterprise Data Hub Solutions provides business intelligence platforms to enterprise clients...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "very generic",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": false,
            "issues": [
              "Contains only industry generic phrases",
              "No specific company information",
              "Missing sign-off",
              "Could describe any BI company"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Exa search returned no specific information. Newsletter consists entirely of generic business intelligence industry statements"
            ]
          }
        }
      ]
    },
    {
      "id": "6",
      "name": "WRITER_AGENT_FABRICATES_CONTENT_ON_EMPTY_SEARCH_RESULTS",
      "problematicBehavior": "When Exa search returns no results or insufficient data, the writer agent hallucinates and fabricates specific details including funding amounts, investor names, founder information, team details, and product specifications instead of acknowledging the lack of available information or requesting additional data sources.",
      "involvedComponents": [
        {
          "name": "search_company_tool",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "search_news_tool",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        },
        {
          "name": "write_newsletter_task",
          "file": "company_researcher.py",
          "type": "ComponentType.FUNCTION"
        }
      ],
      "traceback": [
        {
          "frame": "Frame #1",
          "description": "Exa search returns empty results for unknown company"
        },
        {
          "frame": "Frame #2",
          "description": "Search tools return empty strings instead of explicit \"NO DATA\" signal"
        },
        {
          "frame": "Frame #3",
          "description": "Researcher agent passes empty research to writer without validation"
        },
        {
          "frame": "Frame #4",
          "description": "Writer agent prompt lacks instructions to refuse task when data insufficient"
        },
        {
          "frame": "Frame #5",
          "description": "Writer LLM fabricates specific details to complete the assigned task"
        }
      ],
      "recommendedFixes": [
        {
          "type": "code",
          "title": "Add explicit no-data handling in search tools",
          "description": "Modify search_company_tool and search_news_tool to return explicit messages when no results are found. Change the return logic to check if response.results is empty and return a clear \"NO DATA FOUND\" message instead of an empty string. This provides clear signal to downstream agents that research failed.",
          "file": "company_researcher.py",
          "lines": "35-42"
        },
        {
          "type": "prompt",
          "title": "Add anti-hallucination constraints to writer prompt",
          "description": "Update the write_newsletter_task description to include explicit instructions: \"CRITICAL: If the research findings are empty or insufficient, you MUST state that insufficient information is available and refuse to write the newsletter. NEVER fabricate funding amounts, investor names, founder information, or any other specific details not explicitly provided in the research. Only write content that is directly supported by the research data.\"",
          "file": "company_researcher.py",
          "lines": "115-124"
        },
        {
          "type": "prompt",
          "title": "Add data validation to researcher backstory",
          "description": "Enhance the researcher agent\"s backstory and research_task to include validation responsibilities: \"You verify that sufficient reliable information exists before reporting findings. If search tools return no data or insufficient data, you explicitly state DATA INSUFFICIENT in your report and list what information is missing.\"",
          "file": "company_researcher.py",
          "lines": "79-113"
        }
      ],
      "relatedFailedTests": [
        {
          "case_data": {
            "case_input": "{\"company_name\": \"Acme Stealth Startup\"}",
            "reference_value": "{\"newsletter_quality\": \"good\", \"includes_products\": true, \"includes_recent_news\": false, \"includes_company_background\": true, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"3-5 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! Acme Stealth Startup recently raised $10M in Series A funding led by Sequoia Capital...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "professional but fabricated",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": false,
            "issues": [
              "Hallucinated funding amount - not found in research",
              "Made up investor name",
              "Very thin content due to lack of real data"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent hallucinated specific details (funding, investors) that were not in the research data. Exa search returned no results, but writer tried to create a newsletter anyway"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"MysticFlow Labs\"}",
            "reference_value": "{\"newsletter_quality\": \"fair\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"2-3 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! MysticFlow Labs secured $15M in Series A from Andreessen Horowitz to develop blockchain infrastructure...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "professional but fabricated",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": false,
            "issues": [
              "Completely fabricated funding details",
              "Made up investor names",
              "Invented technology focus",
              "No actual research data"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent created a complete fictional newsletter when Exa returned no results. Hallucinated funding, investors, and product details with no basis"
            ]
          }
        },
        {
          "case_data": {
            "case_input": "{\"company_name\": \"VaporWare Tech\"}",
            "reference_value": "{\"newsletter_quality\": \"poor\", \"includes_products\": false, \"includes_recent_news\": false, \"includes_company_background\": false, \"includes_market_position\": false, \"tone\": \"professional\", \"length\": \"1-2 paragraphs\", \"has_greeting\": true, \"has_signoff\": true}"
          },
          "output_for_assertions": {
            "newsletter_text": "Welcome to this week's company spotlight! VaporWare Tech was founded by Jane Doe and John Smith, former executives at Google and Meta...",
            "newsletter_quality": "poor",
            "includes_products": false,
            "includes_recent_news": false,
            "includes_company_background": false,
            "includes_market_position": false,
            "tone": "professional but fabricated",
            "length": "2 paragraphs",
            "has_greeting": true,
            "has_signoff": true,
            "issues": [
              "Hallucinated founder names",
              "Made up previous company affiliations",
              "All team information is fabricated"
            ]
          },
          "assertions_result": {
            "passed": false,
            "errors": [
              "Writer agent created fictional founder and team information when no data was available. This demonstrates dangerous hallucination behavior"
            ]
          }
        }
      ]
    }
  ]
}
</script>
<script>
        // Load report data from embedded JSON
        const reportData = JSON.parse(document.getElementById('report-data').textContent);
        
        // Helper functions
        function getClusterSeverity(cluster) {
            const hasFabrication = cluster.name.toLowerCase().includes('fabricat') || cluster.name.toLowerCase().includes('hallucinat');
            const hasDataLoss = cluster.name.toLowerCase().includes('truncat') || cluster.name.toLowerCase().includes('loses');
            const testCount = cluster.relatedFailedTests.length;
            const fixCount = cluster.recommendedFixes.length;
            
            if (hasFabrication) return 'critical';
            if (hasDataLoss || testCount > 5) return 'high';
            if (fixCount > 2 || testCount > 0) return 'medium';
            return 'low';
        }
        
        function getFixTypeIcon(type) {
            const icons = {
                prompt: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>`,
                code: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
                config: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>`,
                design: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`
            };
            return icons[type] || icons.prompt;
        }
        
        function getFixTypeClass(type) {
            return type;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // State management
        let expandedClusters = new Set();
        let expandedFixes = new Set();
        let expandedTests = new Set();
        
        function toggleCluster(clusterId) {
            if (expandedClusters.has(clusterId)) {
                expandedClusters.delete(clusterId);
            } else {
                expandedClusters.add(clusterId);
            }
            renderClusters();
        }
        
        function toggleFix(fixId) {
            if (expandedFixes.has(fixId)) {
                expandedFixes.delete(fixId);
            } else {
                expandedFixes.add(fixId);
            }
            renderClusters();
        }
        
        function toggleTest(testId) {
            if (expandedTests.has(testId)) {
                expandedTests.delete(testId);
            } else {
                expandedTests.add(testId);
            }
            renderClusters();
        }
        
        // Render functions
        function renderClusters() {
            const container = document.getElementById('clustersContainer');
            if (!container || !reportData) return;
            
            container.innerHTML = reportData.clusters.map((cluster, index) => {
                const clusterNumber = index + 1;
                const severity = getClusterSeverity(cluster);
                const isExpanded = expandedClusters.has(cluster.id);
                
                return `<div class="cluster-card ${isExpanded ? 'expanded ' + severity : ''}">
                    <button class="cluster-header" onclick="toggleCluster('${cluster.id}')">
                        <div class="chevron">
                            ${isExpanded ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>'}
                        </div>
                        <div class="cluster-info">
                            <div class="cluster-title-row">
                                <span class="cluster-number">#${clusterNumber}</span>
                                <span class="cluster-name">${escapeHtml(cluster.name)}</span>
                                <span class="severity-badge ${severity}">${severity.toUpperCase()}</span>
                            </div>
                            <div class="cluster-meta">
                                <span class="cluster-meta-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                                    ${cluster.involvedComponents.length} component${cluster.involvedComponents.length !== 1 ? 's' : ''}
                                </span>
                                <span class="cluster-meta-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
                                    ${cluster.recommendedFixes.length} fix${cluster.recommendedFixes.length !== 1 ? 'es' : ''}
                                </span>
                                <span class="cluster-meta-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5s-2.5-1.1-2.5-2.5V2"/><path d="M8.5 2h7"/><path d="M14.5 16h-5"/></svg>
                                    ${cluster.relatedFailedTests.length} test${cluster.relatedFailedTests.length !== 1 ? 's' : ''}
                                </span>
                            </div>
                        </div>
                    </button>
                    ${isExpanded ? renderClusterContent(cluster, severity) : ''}
                </div>`;
            }).join('');
        }
        
        function renderClusterContent(cluster, severity) {
            const severityColors = {
                critical: { icon: 'rgb(248, 113, 113)' },
                high: { icon: 'rgb(251, 146, 60)' },
                medium: { icon: 'rgb(250, 204, 21)' },
                low: { icon: 'rgb(96, 165, 250)' }
            };
            const iconColor = severityColors[severity]?.icon || 'rgb(248, 113, 113)';
            
            return `
                <div class="cluster-content expanded">
                    <div class="section">
                        <div class="problematic-behavior">
                            <div class="section-header">
                                <div class="section-icon alert" style="color: ${iconColor};">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2l8 14a2 2 0 0 0 2 2h9.73a2 2 0 0 0 2-2z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                                </div>
                                <h3 class="section-title">Problematic Behavior</h3>
                            </div>
                            <p>${escapeHtml(cluster.problematicBehavior)}</p>
                        </div>
                    </div>
                    ${cluster.involvedComponents.length > 0 ? renderComponents(cluster.involvedComponents) : ''}
                    ${cluster.traceback.length > 0 ? renderTraceback(cluster.traceback) : ''}
                    ${cluster.recommendedFixes.length > 0 ? renderFixes(cluster.id, cluster.recommendedFixes) : ''}
                    ${cluster.relatedFailedTests.length > 0 ? renderTests(cluster.id, cluster.relatedFailedTests) : ''}
                </div>
            `;
        }
        
        function renderComponents(components) {
            return `
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon code">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                        </div>
                        <h3 class="section-title">Involved Components (${components.length})</h3>
                    </div>
                    <div class="components-grid">
                        ${components.map(comp => `
                            <div class="component-card">
                                <div class="component-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></svg>
                                    <div class="component-name">${escapeHtml(comp.name)}</div>
                                </div>
                                <div class="component-file">${escapeHtml(comp.file)}</div>
                                <div class="component-type">${escapeHtml(comp.type.replace('ComponentType.', ''))}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderTraceback(traceback) {
            return `
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon traceback">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>
                        </div>
                        <h3 class="section-title">Traceback (${traceback.length} frames)</h3>
                    </div>
                    <div class="traceback-list">
                        ${traceback.map(frame => `
                            <div class="traceback-frame">
                                <div class="traceback-frame-label">${escapeHtml(frame.frame)}</div>
                                <div class="traceback-description">${escapeHtml(frame.description)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderFixes(clusterId, fixes) {
            return `
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon fixes">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
                        </div>
                        <h3 class="section-title">Recommended Fixes (${fixes.length})</h3>
                    </div>
                    <div class="fixes-list">
                        ${fixes.map((fix, idx) => {
                            const fixId = `${clusterId}-fix-${idx}`;
                            const isExpanded = expandedFixes.has(fixId);
                            const fixClass = getFixTypeClass(fix.type);
                            return `
                                <div class="fix-card ${isExpanded ? 'expanded' : ''}">
                                    <button class="fix-header" onclick="toggleFix('${fixId}')">
                                        <div class="fix-icon-box ${fixClass}">
                                            ${getFixTypeIcon(fix.type)}
                                        </div>
                                        <div class="fix-info">
                                            <div class="fix-title-row">
                                                <span class="fix-type-badge ${fixClass}">${fix.type.toUpperCase()}</span>
                                                <span class="fix-title">${escapeHtml(fix.title)}</span>
                                            </div>
                                            <div class="fix-meta">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></svg>
                                                <span class="fix-meta-file">${escapeHtml(fix.file)}</span>
                                                ${fix.lines ? `<span>‚Ä¢</span><span class="fix-lines">Lines ${escapeHtml(fix.lines)}</span>` : ''}
                                            </div>
                                        </div>
                                        <div class="fix-chevron ${isExpanded ? 'expanded' : ''}">
                                            ${isExpanded ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>'}
                                        </div>
                                    </button>
                                    ${isExpanded ? `<div class="fix-description expanded"><p>${escapeHtml(fix.description)}</p></div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderTests(clusterId, tests) {
            return `
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon tests">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5s-2.5-1.1-2.5-2.5V2"/><path d="M8.5 2h7"/><path d="M14.5 16h-5"/></svg>
                        </div>
                        <h3 class="section-title">Related Failed Tests (${tests.length})</h3>
                    </div>
                    <div class="tests-list">
                        ${tests.map((test, idx) => {
                            const testId = `${clusterId}-test-${idx}`;
                            const isExpanded = expandedTests.has(testId);
                            return `
                                <div class="test-card">
                                    <button class="test-header" onclick="toggleTest('${testId}')">
                                        <div class="test-info">
                                            <div class="test-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                                            </div>
                                            <div>
                                                <div class="test-title-row">
                                                    <span class="test-title">Test Case #${idx + 1}</span>
                                                    <span class="test-failed-badge">FAILED</span>
                                                </div>
                                                <div class="test-error-count">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2l8 14a2 2 0 0 0 2 2h9.73a2 2 0 0 0 2-2z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                                                    ${test.assertions_result.errors.length} error${test.assertions_result.errors.length !== 1 ? 's' : ''}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="test-chevron ${isExpanded ? 'expanded' : ''}">
                                            ${isExpanded ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>'}
                                        </div>
                                    </button>
                                    ${isExpanded ? renderTestContent(test) : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderTestContent(test) {
            const caseInput = typeof test.case_data.case_input === 'string' 
                ? test.case_data.case_input 
                : JSON.stringify(test.case_data.case_input, null, 2);
            const output = JSON.stringify(test.output_for_assertions, null, 2);
            
            return `
                <div class="test-content expanded">
                    <div class="test-section input">
                        <div class="test-section-header">
                            <div class="test-section-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            </div>
                            <div class="test-section-title">Input</div>
                        </div>
                        <pre>${escapeHtml(caseInput)}</pre>
                    </div>
                    <div class="test-section output">
                        <div class="test-section-header">
                            <div class="test-section-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            </div>
                            <div class="test-section-title">Output</div>
                        </div>
                        <pre>${escapeHtml(output)}</pre>
                    </div>
                    <div>
                        <div class="test-errors-header">
                            <div class="test-errors-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2l8 14a2 2 0 0 0 2 2h9.73a2 2 0 0 0 2-2z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                            </div>
                            <div class="test-errors-title">Errors (${test.assertions_result.errors.length})</div>
                        </div>
                        <div class="test-errors">
                            ${test.assertions_result.errors.map(error => `
                                <div class="test-error-item">
                                    <p>${escapeHtml(error)}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Calculate and update summary statistics
        function updateSummaryStats() {
            if (!reportData) return;
            
            // Calculate all statistics from clusters data
            const criticalClusters = reportData.clusters.filter(c => getClusterSeverity(c) === 'critical').length;
            const highClusters = reportData.clusters.filter(c => getClusterSeverity(c) === 'high').length;
            const totalFixes = reportData.clusters.reduce((sum, c) => sum + c.recommendedFixes.length, 0);
            const totalTests = reportData.clusters.reduce((sum, c) => sum + c.relatedFailedTests.length, 0);
            const totalErrorGroups = reportData.clusters.length;
            
            // Update summary cards
            const criticalEl = document.getElementById('criticalCount');
            const highEl = document.getElementById('highCount');
            const fixesEl = document.getElementById('fixesCount');
            const testsEl = document.getElementById('testsCount');
            
            if (criticalEl) criticalEl.textContent = criticalClusters;
            if (highEl) highEl.textContent = highClusters;
            if (fixesEl) fixesEl.textContent = totalFixes;
            if (testsEl) testsEl.textContent = totalTests;
            
            // Update header badges
            const errorGroupsEl = document.getElementById('errorGroupsCount');
            if (errorGroupsEl) errorGroupsEl.textContent = totalErrorGroups;
            
            const sourceFileEl = document.getElementById('sourceFile');
            if (sourceFileEl && reportData.generatedFrom) {
                sourceFileEl.textContent = reportData.generatedFrom;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Report data loaded:', reportData.clusters.length, 'clusters');
            updateSummaryStats();
            renderClusters();
        });

    </script>
</body>
</html>